<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>
<title>Remoku App Input Test</title>
<style>
body{text-align:center;}
.icons{max-height:50px;}
li{float:left; list-style-type: none; text-align:center; margin:10px;}
a{text-decoration:none;color:black;}
</style>

<script>
var rokupostframe;
var rokuAddress = "192.168.1.10";
var appidarray = [];

function loadRokuImages(){
	var appid = appidarray.shift();
	document.getElementById(appid).src = 'http://' + rokuAddress +':8060/query/icon/' + appid;
	}

function rokupost(action, param){
	
	if(!rokupostframe){
	rokupostframe = document.createElement("iframe");
	rokupostframe.name="rokuresponse"
	rokupostframe.id="rokuresponse";
	rokupostframe.style.visibility="hidden";
	rokupostframe.style.display="none";
	rokupostframe = document.body.appendChild(rokupostframe);
	}
	var rokupost = document.getElementById('rokupost');
	rokupost.setAttribute("action", "http://" + rokuAddress + ":8060/" +
		action + "/" + param);
	rokupost.submit();
	//rokupost.focus();
	return false;
}

function rokulaunch(id){
	//alert (id);
	rokupost("launch",id);
	}
function clickme(){
	var textin = document.getElementById("in").value;
	var applist = document.getElementById("applist");
	var apparray = [];
	if (window.DOMParser)
		{
		parser=new DOMParser();
		xmlDoc=parser.parseFromString(textin,"text/xml");
		}
	else // Internet Explorer
		{
		xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
		xmlDoc.async="false";
		xmlDoc.loadXML(textin);
		}
	apps = xmlDoc.getElementsByTagName("app");
	for (i=0;i<apps.length;i++)
		{
		var appid = apps[i].attributes.getNamedItem("id").value;
		var appname = (apps[i].childNodes[0].nodeValue);
		//alert(appname + " " + appid);
		var appitem = document.createElement('li');
		appitem.innerHTML = "<a href='#"+appid+"' onclick='rokulaunch("+ appid +");'>" +
		"<img class='icons' id=" + appid + " src='' onload='loadRokuImages()'><br>" + 
		appname + "</>"; //src='http://' + rokuAddress +':8060/query/icon/' + appid
		applist.appendChild(appitem);
		appidarray.push(appid);
		}
		
	appid = appidarray.shift();
	document.getElementById(appid).src = 'http://' + rokuAddress +':8060/query/icon/' + appid;

		// Move innerHTML calls to array, 
		
		
}
</script>
</head>
<body>
<div id="container">
<textarea id="in" style="width:120px; height:120px;"></textarea>
<button id="clickme" onclick="clickme();">Submit Apps</button>
</div>
<div id="apps">
<ul id="applist">
</ul>
</div>
<form id="rokupost" method="post" target="rokuresponse"></form>
</body>
</html>